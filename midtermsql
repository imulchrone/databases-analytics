DROP TABLE Student;
DROP TABLE Course;
DROP TABLE Grade;

CREATE TABLE Student
(
    StudentID NUMBER PRIMARY KEY,
    Name VARCHAR(50),
    Address VARCHAR(25),
    GradYear NUMBER(4)
);

CREATE TABLE Course
(
    CName VARCHAR(20) PRIMARY KEY,
    Department VARCHAR(20),
    Credits NUMBER(1)
);

CREATE TABLE Grade
(
    CName VARCHAR(20),
    StudentID NUMBER,
    CGrade NUMBER(*,1),
    
    FOREIGN KEY (CName)
        REFERENCES Course(CName),
        
    FOREIGN KEY (StudentID)
        REFERENCES Student(StudentID)
);

INSERT INTO Student VALUES(1, 'Smith, John S', 'Chicago IL', 2019);
INSERT INTO Student VALUES(2, 'Smith, Muriel K', 'Chicago IL', 2015);
INSERT INTO Student VALUES(3, 'Jones, Muriel L', 'Detroit MI', 2010);
INSERT INTO Student VALUES(4, 'Jacobs, Mark M', 'Milwaukee WI', 2004);
INSERT INTO Student VALUES(5, 'Jordan, Michael B', 'Chicago IL', 2009);

INSERT INTO Course VALUES('Calculus', 'Mathematics', 4);
INSERT INTO Course VALUES('US History', 'History', 4);
INSERT INTO Course VALUES('Painting', 'Art', 3);
INSERT INTO Course VALUES('Chemistry', 'Science', 4);

INSERT INTO Grade VALUES('Calculus', 1, 3.3);
INSERT INTO Grade VALUES('Calculus', 4, 3.0);
INSERT INTO Grade VALUES('US History', 2, 4.0);
INSERT INTO Grade VALUES('Painting', 1, 2.5);
INSERT INTO Grade VALUES('US History', 3, 3.0);
INSERT INTO Grade VALUES('Painting', 2, 3.6);

SELECT * FROM Student;
SELECT * FROM Course;
SELECT * FROM Grade;

--2-1
SELECT StudentID, Name FROM Student
WHERE GradYear - (SELECT MIN(GradYear) FROM STUDENT) < 10;

--2-2
SELECT Name, CName FROM Student, Grade
WHERE Student.StudentID = Grade.StudentID AND
Name LIKE '%Muriel%';

SELECT Name, CName FROM Student JOIN Grade ON Student.StudentID = Grade.StudentID
WHERE Name LIKE '%Muriel%'
ORDER BY CGrade;

--2-3--------------------
SELECT Name, GradYear, Count(*) FROM Student LEFT JOIN Grade ON Student.StudentID = Grade.StudentID
GROUP BY Name, GradYear
HAVING COUNT(*) <= 1;

----------------------------


--2-4
UPDATE Student
SET GradYear = GradYear + 3
WHERE Address LIKE 'Chicago%';

--2-5
ALTER TABLE Course
ADD Chair VARCHAR(26);

DROP VIEW Records;

CREATE VIEW Records AS
SELECT Student.StudentID, Name, Address, GradYear, Course.CName, CGrade, Department, Credits FROM Course
LEFT JOIN Grade ON Course.CName = Grade.CName
LEFT JOIN Student ON Student.StudentID = Grade.StudentID
UNION
SELECT Student.StudentID, Name, Address, GradYear, Course.CName, CGrade, Department, Credits FROM Student
LEFT JOIN Grade ON Student.StudentID = Grade.StudentID
LEFT JOIN Course ON Course.CName = Grade.CName;

SELECT * FROM Records;

SELECT COUNT(*) FROM Records;

INSERT INTO Grade VALUES('US History',1,3.0);

SELECT Department, MIN(GradYear), MAX(GradYear), AVG(Credits) FROM Course
JOIN Grade ON Course.CName = Grade.CName
JOIN Student ON Grade.StudentID = Student.StudentID
GROUP BY Department;

SELECT Department, MIN(GradYear), MAX(GradYear), AVG(Credits) FROM Records
WHERE Department IS NOT NULL
GROUP BY Department
HAVING MIN(GradYear) IS NOT NULL;


